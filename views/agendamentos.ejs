<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Agendamentos</title>
    <style>
        .selected {
            background-color: #d3f8e2; /* Cor de fundo quando o item é selecionado */
        }
    </style>
</head>
<body>
    <h1>Lista de Agendamentos</h1>
    <ul id="agendamentosList">
        <% agendamentos.forEach(agendamento => { %>
            <li id="agendamento_<%= agendamento._id %>" class="agendamento-item" onclick="selecionarAgendamento('<%= agendamento._id %>')">
                <strong>Médico:</strong> <%= agendamento.nomeMedico %> <br>
                <strong>Paciente:</strong> <%= agendamento.nomePaciente %> <br>
                <strong>Tipo de Animal:</strong> <%= agendamento.tipoDeAnimal %> <br>
                <strong>Data:</strong> <%= agendamento.dataAgendamento.toLocaleDateString("pt-BR") %> <br>
                <strong>Disponível:</strong> <%= agendamento.disponivel ? 'Sim' : 'Não' %> <br>
            </li>
            <hr>
        <% }) %>
    </ul>

    <button id="agendarButton" onclick="confirmarAgendamento()">Agendar</button>

    <script>
        let agendamentoSelecionado = null;
        let pacienteId = 'userId';  // Aqui você deve pegar o ID do paciente atual, se necessário.
    
        // Função para selecionar um agendamento ao clicar no item
        function selecionarAgendamento(agendamentoId) {
            // Remove a classe 'selected' de todos os itens
            const items = document.querySelectorAll('.agendamento-item');
            items.forEach(item => item.classList.remove('selected'));
    
            // Adiciona a classe 'selected' ao item clicado
            const itemSelecionado = document.getElementById('agendamento_' + agendamentoId);
            itemSelecionado.classList.add('selected');
    
            // Armazena o id do agendamento selecionado
            agendamentoSelecionado = agendamentoId;
        }
    
        // Função para confirmar o agendamento
        function confirmarAgendamento() {
            if (agendamentoSelecionado) {
                // Envia a requisição para o servidor
                fetch('/agendamentos/agendar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        agendamentoId: agendamentoSelecionado,
                        pacienteId: pacienteId,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                })
                .catch(error => {
                    console.error('Erro ao agendar:', error);
                    alert('Erro ao agendar o agendamento.');
                });
            } else {
                alert('Selecione um agendamento antes de confirmar.');
            }
        }
    </script>
</body>
</html>
